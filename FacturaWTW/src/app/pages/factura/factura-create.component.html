<div class="container mt-4 factura-card shadow-lg p-4 rounded">
  <h3 class="text-center text-primary mb-4" *ngIf="!facturaId">üìù Crear Factura</h3>
  <h3 class="text-center text-warning mb-4" *ngIf="facturaId">‚úèÔ∏è Editar Factura</h3>

  <form [formGroup]="facturaForm" (ngSubmit)="guardar()">
    <!-- N√∫mero de factura -->
    <div class="mb-3">
      <label class="form-label fw-bold">N√∫mero factura</label>
      <input class="form-control" formControlName="NumeroFactura" type="number" />
    </div>

    <!-- Cliente -->
    <div class="mb-3">
      <label class="form-label fw-bold">Cliente</label>
      <select class="form-select" formControlName="IdCliente">
        <option *ngFor="let c of clientes" [value]="c.Id">
          {{ c.RazonSocial }}
        </option>
      </select>
    </div>

    <!-- Detalles -->
    <div formArrayName="Detalles">
      <h5 class="mt-4 text-secondary">Detalles de Productos</h5>
      <div
        *ngFor="let d of detalles.controls; let i = index"
        [formGroupName]="i"
        class="mb-3 border p-3 rounded detalle-box"
      >
        <!-- Producto -->
        <label class="form-label">Producto</label>
        <select formControlName="IdProducto" class="form-select mb-2">
          <option *ngFor="let p of productos" [value]="p.Id">
            {{ p.NombreProducto }}
          </option>
        </select>

        <!-- Cantidad y Precio -->
        <div class="row mb-2">
          <div class="col">
            <input
              type="number"
              class="form-control"
              formControlName="CantidadDeProducto"
              placeholder="Cantidad"
            />
          </div>
          <div class="col">
            <input
              type="number"
              class="form-control"
              formControlName="PrecioUnitarioProducto"
              placeholder="Precio unitario"
            />
          </div>
        </div>

        <!-- Subtotal calculado -->
        <div class="subtotal-box">
          <strong>Subtotal:</strong>
          <span class="text-success fw-bold">
            {{ d.get('SubtotalProducto')?.value | currency }}
          </span>
        </div>
      </div>
    </div>

    <!-- Bot√≥n agregar detalle -->
    <button
      class="btn btn-outline-info mt-2"
      type="button"
      (click)="addDetalle()"
    >
      ‚ûï Agregar producto
    </button>

    <!-- Total -->
    <div class="mt-4 total-box text-end">
      <h4 class="fw-bold">
        üí∞ Total: <span class="text-success">{{ totalFactura | currency }}</span>
      </h4>
    </div>

    <!-- Botones -->
    <div class="mt-4 text-center">
      <button class="btn btn-success me-2 px-4" type="submit">
        ‚úÖ Guardar
      </button>
      <button class="btn btn-outline-danger px-4" type="button" (click)="cancelar()">
        ‚ùå Cancelar
      </button>
    </div>
  </form>
</div>
